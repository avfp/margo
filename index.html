<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Project Margo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-950 text-white min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function MargoApp() {
            const [view, setView] = useState('dash');
            const [data, setData] = useState(() => {
                const saved = localStorage.getItem('margo_final');
                return saved ? JSON.parse(saved) : {
                    xp: 0,
                    habits: [],
                    completed: [],
                    streaks: {}
                };
            });

            useEffect(() => {
                localStorage.setItem('margo_final', JSON.stringify(data));
            }, [data]);

            // Functions
            const addQuest = (name) => {
                const id = Date.now().toString();
                setData(prev => ({
                    ...prev,
                    habits: [...prev.habits, { id, name }]
                }));
            };

            const deleteQuest = (id) => {
                setData(prev => ({
                    ...prev,
                    habits: prev.habits.filter(h => h.id !== id),
                    completed: prev.completed.filter(c => c !== id)
                }));
            };

            const toggleQuest = (id) => {
                const isDone = data.completed.includes(id);
                setData(prev => ({
                    ...prev,
                    xp: isDone ? Math.max(0, prev.xp - 10) : prev.xp + 15,
                    completed: isDone ? prev.completed.filter(c => c !== id) : [...prev.completed, id],
                    streaks: { ...prev.streaks, [id]: isDone ? Math.max(0, (prev.streaks[id] || 1) - 1) : (prev.streaks[id] || 0) + 1 }
                }));
            };

            // Components
            const Dashboard = () => (
                <div className="space-y-6">
                    <div className="bg-slate-900 p-8 rounded-2xl border-2 border-purple-500 text-center">
                        <h2 className="text-4xl font-bold mb-2">Character Level {Math.floor(data.xp / 100) + 1}</h2>
                        <p className="text-purple-400">Total XP: {data.xp}</p>
                        <div className="w-full bg-black h-3 rounded-full mt-4 overflow-hidden">
                            <div className="bg-purple-500 h-full transition-all" style={{width: `${data.xp % 100}%`}}></div>
                        </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-slate-900 p-4 rounded-xl border border-white/10 text-center">
                            <p className="text-sm text-slate-400">Quests Done</p>
                            <p className="text-2xl font-bold">{data.completed.length}</p>
                        </div>
                        <div className="bg-slate-900 p-4 rounded-xl border border-white/10 text-center">
                            <p className="text-sm text-slate-400">Active Habits</p>
                            <p className="text-2xl font-bold">{data.habits.length}</p>
                        </div>
                    </div>
                </div>
            );

            const Quests = () => {
                const [input, setInput] = useState('');
                return (
                    <div className="space-y-4">
                        <div className="flex gap-2">
                            <input 
                                className="bg-slate-900 border border-white/10 p-3 rounded-lg flex-1 outline-none focus:border-purple-500" 
                                placeholder="Enter quest name..."
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                            />
                            <button 
                                onClick={() => { if(input) { addQuest(input); setInput(''); } }}
                                className="bg-purple-600 px-6 rounded-lg font-bold"
                            >Add</button>
                        </div>
                        {data.habits.map(h => (
                            <div key={h.id} className="bg-slate-900 p-4 rounded-xl border border-white/5 flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <button 
                                        onClick={() => toggleQuest(h.id)}
                                        className={`w-8 h-8 rounded-lg border-2 ${data.completed.includes(h.id) ? 'bg-green-500 border-green-400' : 'border-slate-700'}`}
                                    >
                                        {data.completed.includes(h.id) ? 'âœ“' : ''}
                                    </button>
                                    <div>
                                        <p className={data.completed.includes(h.id) ? 'line-through text-slate-500' : 'font-bold'}>{h.name}</p>
                                        <p className="text-xs text-orange-500">ðŸ”¥ {data.streaks[h.id] || 0} Day Streak</p>
                                    </div>
                                </div>
                                <button onClick={() => deleteQuest(h.id)} className="text-slate-600 hover:text-red-500 font-bold">âœ•</button>
                            </div>
                        ))}
                    </div>
                );
            };

            return (
                <div className="max-w-xl mx-auto p-6">
                    <div className="flex justify-between items-center mb-10">
                        <h1 className="text-2xl font-black tracking-tighter text-purple-500">MARGO</h1>
                        <div className="flex gap-4">
                            <button onClick={() => setView('dash')} className={view === 'dash' ? 'text-purple-400' : 'text-slate-500'}>Dash</button>
                            <button onClick={() => setView('quests')} className={view === 'quests' ? 'text-purple-400' : 'text-slate-500'}>Quests</button>
                        </div>
                    </div>
                    {view === 'dash' ? <Dashboard /> : <Quests />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MargoApp />);
    </script>
</body>
</html>
