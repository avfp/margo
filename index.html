<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Margo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        .animate-bounce { animation: bounce 1s infinite; }
    </style>
</head>
<body class="bg-slate-950">
    <div id="root"></div>

    <script type="text/babel">
        // Import Lucide icons from the global 'lucide' object
        const { 
            Check, Plus, Edit2, Trash2, Star, Flame, Trophy, Target, 
            Book, Feather, Crown, Heart, Sparkles, Sword, Shield, Zap 
        } = lucide;
        const { useState, useEffect } = React;

        const ProjectMargo = () => {
          const pathIcons = { scholar: Book, author: Feather, leader: Crown, vessel: Heart };
          const pathColors = {
            scholar: 'from-cyan-400 via-blue-500 to-indigo-600',
            author: 'from-purple-400 via-violet-500 to-fuchsia-600',
            leader: 'from-amber-400 via-orange-500 to-red-600',
            vessel: 'from-pink-400 via-rose-500 to-red-600'
          };
          const pathBorders = { scholar: 'border-blue-500', author: 'border-purple-500', leader: 'border-orange-500', vessel: 'border-pink-500' };

          const achievementList = [
            { id: 'first_step', name: 'First Steps', desc: 'Complete your first habit', icon: 'ðŸŒŸ', xp: 50, condition: (data) => data.completedToday.length >= 1 },
            { id: 'week_warrior', name: 'Week Warrior', desc: 'Maintain a 7-day streak', icon: 'âš”ï¸', xp: 200, condition: (data) => Object.values(data.streaks).some(s => s >= 7) },
            { id: 'level_five', name: 'Rising Hero', desc: 'Reach level 5 in any path', icon: 'ðŸ›¡ï¸', xp: 300, condition: (data) => Object.values(data.paths).some(p => p.level >= 5) },
            { id: 'all_paths', name: 'Renaissance Soul', desc: 'Have at least 1 habit in all 4 paths', icon: 'âœ¨', xp: 500, condition: (data) => Object.keys(data.paths).every(key => data.dailyHabits.some(h => h.pathKey === key)) },
            { id: 'perfectionist', name: 'Perfectionist', desc: 'Complete all habits in a single day', icon: 'ðŸ’Ž', xp: 250, condition: (data) => data.dailyHabits.length > 0 && data.completedToday.length === data.dailyHabits.length },
            { id: 'milestone_master', name: 'Milestone Master', desc: 'Create 10 milestones', icon: 'ðŸ†', xp: 400, condition: (data) => Object.values(data.roadmaps).flat().length >= 10 },
            { id: 'month_legend', name: 'Legendary Streak', desc: 'Maintain a 30-day streak', icon: 'ðŸ”¥', xp: 1000, condition: (data) => Object.values(data.streaks).some(s => s >= 30) },
            { id: 'ten_levels', name: 'Master of Craft', desc: 'Reach level 10 in any path', icon: 'ðŸ‘‘', xp: 750, condition: (data) => Object.values(data.paths).some(p => p.level >= 10) },
          ];

          const [activeView, setActiveView] = useState('dashboard');
          const [selectedPath, setSelectedPath] = useState(null);
          const [showAchievementPopup, setShowAchievementPopup] = useState(null);
          const [gameData, setGameData] = useState({
            character: { name: 'Hero', title: 'Novice Adventurer', avatar: 'ðŸ§™â€â™€ï¸' },
            paths: {
              scholar: { name: 'The Scholar', level: 1, xp: 0, maxXp: 100 },
              author: { name: 'The Author', level: 1, xp: 0, maxXp: 100 },
              leader: { name: 'The Leader', level: 1, xp: 0, maxXp: 100 },
              vessel: { name: 'The Vessel', level: 1, xp: 0, maxXp: 100 }
            },
            roadmaps: { scholar: [], author: [], leader: [], vessel: [] },
            dailyHabits: [], completedToday: [], streaks: {}, achievements: [], totalXP: 0, lastVisit: new Date().toDateString()
          });

          useEffect(() => {
            const saved = localStorage.getItem('projectMargoData');
            if (saved) { setGameData(JSON.parse(saved)); }
          }, []);

          useEffect(() => {
            localStorage.setItem('projectMargoData', JSON.stringify(gameData));
            checkAchievements();
          }, [gameData]);

          const checkAchievements = () => {
            achievementList.forEach(achievement => {
              if (!gameData.achievements.includes(achievement.id) && achievement.condition(gameData)) {
                setGameData(prev => ({
                  ...prev,
                  achievements: [...prev.achievements, achievement.id],
                  totalXP: prev.totalXP + achievement.xp
                }));
                setShowAchievementPopup(achievement);
                setTimeout(() => setShowAchievementPopup(null), 3000);
              }
            });
          };

          const addXP = (pathKey, amount) => {
            setGameData(prev => {
              const path = prev.paths[pathKey];
              let newXp = path.xp + amount;
              let newLevel = path.level;
              let newMaxXp = path.maxXp;
              while (newXp >= newMaxXp) { newXp -= newMaxXp; newLevel++; newMaxXp = Math.floor(newMaxXp * 1.5); }
              return {
                ...prev,
                paths: { ...prev.paths, [pathKey]: { ...path, xp: newXp, level: newLevel, maxXp: newMaxXp } },
                totalXP: prev.totalXP + amount
              };
            });
          };

          const addMilestone = (pathKey, milestone) => {
            setGameData(prev => ({
              ...prev,
              roadmaps: { ...prev.roadmaps, [pathKey]: [...prev.roadmaps[pathKey], { ...milestone, id: Date.now(), challenges: [] }] }
            }));
          };

          const addChallenge = (pathKey, milestoneId, challenge) => {
            setGameData(prev => ({
              ...prev,
              roadmaps: {
                ...prev.roadmaps,
                [pathKey]: prev.roadmaps[pathKey].map(m => m.id === milestoneId ? { ...m, challenges: [...m.challenges, { ...challenge, id: Date.now(), habits: [] }] } : m )
              }
            }));
          };

          const addHabit = (pathKey, milestoneId, challengeId, habit) => {
            const habitWithId = { ...habit, id: Date.now(), pathKey, milestoneId, challengeId };
            setGameData(prev => ({
              ...prev,
              roadmaps: {
                ...prev.roadmaps,
                [pathKey]: prev.roadmaps[pathKey].map(m => m.id === milestoneId ? { ...m, challenges: m.challenges.map(c => c.id === challengeId ? { ...c, habits: [...c.habits, habitWithId] } : c ) } : m )
              },
              dailyHabits: [...prev.dailyHabits, habitWithId],
              streaks: { ...prev.streaks, [habitWithId.id]: 0 }
            }));
          };

          const toggleHabit = (habitId) => {
            const habit = gameData.dailyHabits.find(h => h.id === habitId);
            if (gameData.completedToday.includes(habitId)) {
              setGameData(prev => ({ ...prev, completedToday: prev.completedToday.filter(id => id !== habitId) }));
              addXP(habit.pathKey, -10);
            } else {
              const streakBonus = Math.floor((gameData.streaks[habitId] || 0) / 7);
              const xpGain = 10 * (1 + streakBonus);
              setGameData(prev => ({ ...prev, completedToday: [...prev.completedToday, habitId], streaks: { ...prev.streaks, [habitId]: (prev.streaks[habitId] || 0) + 1 } }));
              addXP(habit.pathKey, xpGain);
            }
          };

          const deleteMilestone = (pathKey, milestoneId) => {
            setGameData(prev => ({ ...prev, roadmaps: { ...prev.roadmaps, [pathKey]: prev.roadmaps[pathKey].filter(m => m.id !== milestoneId) } }));
          };

          const deleteChallenge = (pathKey, milestoneId, challengeId) => {
            setGameData(prev => ({ ...prev, roadmaps: { ...prev.roadmaps, [pathKey]: prev.roadmaps[pathKey].map(m => m.id === milestoneId ? { ...m, challenges: m.challenges.filter(c => c.id !== challengeId) } : m ) } }));
          };

          const deleteHabit = (habitId) => {
            const habit = gameData.dailyHabits.find(h => h.id === habitId);
            setGameData(prev => ({
              ...prev,
              roadmaps: {
                ...prev.roadmaps,
                [habit.pathKey]: prev.roadmaps[habit.pathKey].map(m => m.id === habit.milestoneId ? { ...m, challenges: m.challenges.map(c => c.id === habit.challengeId ? { ...c, habits: c.habits.filter(h => h.id !== habitId) } : c ) } : m )
              },
              dailyHabits: prev.dailyHabits.filter(h => h.id !== habitId),
              completedToday: prev.completedToday.filter(id => id !== habitId)
            }));
          };

          const Dashboard = () => {
            const totalLevel = Math.floor(Object.values(gameData.paths).reduce((sum, p) => sum + p.level, 0) / 4);
            const todayProgress = gameData.dailyHabits.length > 0 ? Math.round((gameData.completedToday.length / gameData.dailyHabits.length) * 100) : 0;
            return (
              <div className="space-y-6">
                <div className="relative bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 rounded-2xl p-8 border-4 border-purple-500 shadow-2xl">
                  <div className="relative z-10 flex items-center gap-6">
                    <div className="text-7xl">{gameData.character.avatar}</div>
                    <div className="flex-1">
                      <h1 className="text-4xl font-bold text-white mb-1">{gameData.character.name}</h1>
                      <p className="text-purple-300 text-lg mb-3">{gameData.character.title}</p>
                      <div className="flex items-center gap-6">
                        <div className="bg-white/10 px-4 py-2 rounded-lg border border-white/20">
                          <p className="text-white/70 text-xs">Level</p>
                          <p className="text-3xl font-bold text-yellow-300">{totalLevel}</p>
                        </div>
                        <div className="bg-white/10 px-4 py-2 rounded-lg border border-white/20">
                          <p className="text-white/70 text-xs">Total XP</p>
                          <p className="text-2xl font-bold text-cyan-300">{gameData.totalXP}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div className="bg-gradient-to-br from-indigo-900 to-purple-900 rounded-xl p-6 border-2 border-indigo-500">
                  <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2"><Target size={28} /> Today's Progress</h2>
                  <div className="w-full bg-black/30 rounded-full h-6 border border-white/20 overflow-hidden">
                    <div className="h-6 bg-gradient-to-r from-cyan-400 to-purple-500" style={{ width: `${todayProgress}%` }}></div>
                  </div>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {Object.entries(gameData.paths).map(([key, path]) => {
                    const Icon = pathIcons[key];
                    return (
                      <div key={key} className={`bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-6 border-4 ${pathBorders[key]} cursor-pointer`} onClick={() => { setSelectedPath(key); setActiveView('roadmap'); }}>
                        <div className="flex items-center gap-4 mb-4">
                          <div className={`w-16 h-16 rounded-xl bg-gradient-to-br ${pathColors[key]} flex items-center justify-center`}><Icon className="text-white" size={32} /></div>
                          <div><h3 className="font-bold text-2xl text-white">{path.name}</h3><p className="text-yellow-300">Level {path.level}</p></div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            );
          };

          const CharacterSheet = () => (
             <div className="text-white p-8 bg-slate-900 rounded-xl border-2 border-purple-500">
                <h2 className="text-3xl font-bold mb-4">Character Stats</h2>
                <p className="text-xl">XP: {gameData.totalXP}</p>
                <p className="text-xl">Achievements Unlocked: {gameData.achievements.length}</p>
             </div>
          );

          const DailyTracker = () => (
            <div className="space-y-4">
                <h2 className="text-3xl font-bold text-white">Daily Quests</h2>
                {gameData.dailyHabits.map(habit => (
                    <div key={habit.id} className="flex items-center gap-4 p-4 bg-slate-800 rounded-lg border border-white/20">
                        <button onClick={() => toggleHabit(habit.id)} className={`w-8 h-8 rounded border-2 ${gameData.completedToday.includes(habit.id) ? 'bg-green-500' : ''}`}>
                            {gameData.completedToday.includes(habit.id) && <Check size={20} className="text-white" />}
                        </button>
                        <span className="text-white text-lg">{habit.name}</span>
                    </div>
                ))}
            </div>
          );

          const RoadmapView = () => {
            const [newM, setNewM] = useState('');
            if (!selectedPath) return null;
            return (
                <div className="space-y-6">
                    <div className="flex gap-2">
                        <input className="flex-1 p-3 rounded bg-slate-800 text-white" value={newM} onChange={e => setNewM(e.target.value)} placeholder="New Milestone Name" />
                        <button className="bg-purple-600 px-6 rounded text-white font-bold" onClick={() => { addMilestone(selectedPath, {name: newM}); setNewM(''); }}>Add</button>
                    </div>
                    {gameData.roadmaps[selectedPath].map(m => (
                        <div key={m.id} className="p-4 bg-slate-800 rounded border border-indigo-500">
                            <div className="flex justify-between">
                                <h3 className="text-white font-bold text-xl">{m.name}</h3>
                                <button onClick={() => {
                                    const hName = prompt("Enter habit name:");
                                    if(hName) addHabit(selectedPath, m.id, 0, {name: hName});
                                }} className="text-cyan-400">+ Add Quest</button>
                            </div>
                        </div>
                    ))}
                </div>
            );
          };

          return (
            <div className="min-h-screen text-white">
              <nav className="p-4 bg-slate-900 border-b-4 border-purple-500 flex justify-between items-center">
                <h1 className="text-2xl font-bold flex items-center gap-2"><Sparkles /> Project Margo</h1>
                <div className="flex gap-4">
                  <button onClick={() => setActiveView('dashboard')}>Dashboard</button>
                  <button onClick={() => setActiveView('character')}>Character</button>
                  <button onClick={() => setActiveView('tracker')}>Quests</button>
                </div>
              </nav>
              <main className="max-w-4xl mx-auto p-8">
                {activeView === 'dashboard' && <Dashboard />}
                {activeView === 'character' && <CharacterSheet />}
                {activeView === 'tracker' && <DailyTracker />}
                {activeView === 'roadmap' && <RoadmapView />}
              </main>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProjectMargo />);
    </script>
</body>
</html>
