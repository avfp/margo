<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Margo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #020617; color: white; }
        .path-card:hover { transform: translateY(-5px); transition: all 0.3s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const Icon = ({ name, className, size = 20 }) => {
            const LucideIcon = lucide[name];
            return LucideIcon ? <LucideIcon className={className} size={size} /> : null;
        };

        const ProjectMargo = () => {
            const pathIcons = { scholar: 'Book', author: 'Feather', leader: 'Crown', vessel: 'Heart' };
            const pathColors = {
                scholar: 'from-cyan-400 via-blue-500 to-indigo-600',
                author: 'from-purple-400 via-violet-500 to-fuchsia-600',
                leader: 'from-amber-400 via-orange-500 to-red-600',
                vessel: 'from-pink-400 via-rose-500 to-red-600'
            };

            const [activeView, setActiveView] = useState('dashboard');
            const [selectedPath, setSelectedPath] = useState(null);
            const [showAchievementPopup, setShowAchievementPopup] = useState(null);
            
            const [gameData, setGameData] = useState({
                character: { name: 'Hero', title: 'Novice Adventurer', avatar: 'ðŸ§™â€â™€ï¸' },
                paths: {
                    scholar: { name: 'The Scholar', level: 1, xp: 0, maxXp: 100 },
                    author: { name: 'The Author', level: 1, xp: 0, maxXp: 100 },
                    leader: { name: 'The Leader', level: 1, xp: 0, maxXp: 100 },
                    vessel: { name: 'The Vessel', level: 1, xp: 0, maxXp: 100 }
                },
                roadmaps: { scholar: [], author: [], leader: [], vessel: [] },
                dailyHabits: [], completedToday: [], streaks: {}, achievements: [], totalXP: 0
            });

            useEffect(() => {
                const saved = localStorage.getItem('margo_v3');
                if (saved) setGameData(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('margo_v3', JSON.stringify(gameData));
            }, [gameData]);

            const addXP = (pathKey, amount) => {
                setGameData(prev => {
                    const path = prev.paths[pathKey];
                    let newXp = path.xp + amount;
                    let newLevel = path.level;
                    let newMaxXp = path.maxXp;
                    while (newXp >= newMaxXp) {
                        newXp -= newMaxXp;
                        newLevel++;
                        newMaxXp = Math.floor(newMaxXp * 1.5);
                    }
                    return {
                        ...prev,
                        paths: { ...prev.paths, [pathKey]: { ...path, xp: Math.max(0, newXp), level: newLevel, maxXp: newMaxXp } },
                        totalXP: prev.totalXP + amount
                    };
                });
            };

            const addHabit = (pathKey, name) => {
                const id = Date.now().toString();
                setGameData(prev => ({
                    ...prev,
                    dailyHabits: [...prev.dailyHabits, { id, name, pathKey }],
                    streaks: { ...prev.streaks, [id]: 0 }
                }));
            };

            const deleteHabit = (id) => {
                setGameData(prev => ({
                    ...prev,
                    dailyHabits: prev.dailyHabits.filter(h => h.id !== id),
                    completedToday: prev.completedToday.filter(cid => cid !== id)
                }));
            };

            const toggleHabit = (id) => {
                const habit = gameData.dailyHabits.find(h => h.id === id);
                const isCompleting = !gameData.completedToday.includes(id);
                
                setGameData(prev => ({
                    ...prev,
                    completedToday: isCompleting ? [...prev.completedToday, id] : prev.completedToday.filter(cid => cid !== id),
                    streaks: { ...prev.streaks, [id]: isCompleting ? (prev.streaks[id] || 0) + 1 : Math.max(0, (prev.streaks[id] || 1) - 1) }
                }));
                addXP(habit.pathKey, isCompleting ? 15 : -15);
            };

            const Dashboard = () => (
                <div className="space-y-6">
                    <div className="bg-slate-900 p-8 rounded-3xl border-2 border-purple-500 shadow-2xl flex items-center gap-6">
                        <div className="text-6xl">{gameData.character.avatar}</div>
                        <div>
                            <h2 className="text-4xl font-bold">{gameData.character.name}</h2>
                            <p className="text-purple-400 font-medium">{gameData.character.title}</p>
                            <p className="text-cyan-400 text-sm mt-1">Global XP: {gameData.totalXP}</p>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {Object.entries(gameData.paths).map(([key, path]) => (
                            <div key={key} onClick={() => { setSelectedPath(key); setActiveView('roadmap'); }} className="path-card bg-slate-900 p-5 rounded-2xl border border-white/10 cursor-pointer">
                                <div className="flex justify-between items-center mb-3">
                                    <div className="flex items-center gap-2">
                                        <Icon name={pathIcons[key]} className="text-white" />
                                        <span className="font-bold text-lg">{path.name}</span>
                                    </div>
                                    <span className="text-yellow-400 font-bold">Lvl {path.level}</span>
                                </div>
                                <div className="w-full bg-black/40 h-2 rounded-full overflow-hidden">
                                    <div className={`h-full bg-gradient-to-r ${pathColors[key]}`} style={{width: `${(path.xp/path.maxXp)*100}%`}}></div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const Quests = () => {
                const [text, setText] = useState('');
                const [pKey, setPKey] = useState('scholar');
                return (
                    <div className="space-y-6">
                        <div className="bg-slate-800 p-4 rounded-xl flex gap-2">
                            <input className="bg-slate-900 border border-white/10 p-2 rounded flex-1" placeholder="Quest name..." value={text} onChange={e => setText(e.target.value)} />
                            <select className="bg-slate-900 p-2 rounded" value={pKey} onChange={e => setPKey(e.target.value)}>
                                {Object.keys(gameData.paths).map(k => <option key={k} value={k}>{k}</option>)}
                            </select>
                            <button className="bg-purple-600 px-4 rounded font-bold" onClick={() => { if(text) addHabit(pKey, text); setText(''); }}>Add</button>
                        </div>
                        <div className="grid gap-3">
                            {gameData.dailyHabits.map(h => (
                                <div key={h.id} className="bg-slate-900 p-4 rounded-xl border border-white/5 flex items-center justify-between group">
                                    <div className="flex items-center gap-4">
                                        <button onClick={() => toggleHabit(h.id)} className={`w-8 h-8 rounded-lg border-2 flex items-center justify-center transition ${gameData.completedToday.includes(h.id) ? 'bg-green-600 border-green-400' : 'border-slate-600 hover:border-purple-500'}`}>
                                            {gameData.completedToday.includes(h.id) && <Icon name="Check" size={18} />}
                                        </button>
                                        <div>
                                            <p className={`font-bold ${gameData.completedToday.includes(h.id) ? 'line-through text-slate-500' : ''}`}>{h.name}</p>
                                            <div className="flex items-center gap-2 text-xs text-orange-400">
                                                <Icon name="Flame" size={12} />
                                                <span>{gameData.streaks[h.id] || 0} Day Streak</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button onClick={() => deleteHabit(h.id)} className="opacity-0 group-hover:opacity-100 text-slate-600 hover:text-red-500 transition">
                                        <Icon name="Trash2" size={18} />
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen">
                    <nav className="p-4 bg-slate-900/50 backdrop-blur-md border-b border-purple-500/30 sticky top-0 z-50">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <h1 className="text-xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400">PROJECT MARGO</h1>
                            <div className="flex gap-4">
                                <button onClick={() => setActiveView('dashboard')} className={`p-2 rounded-lg ${activeView === 'dashboard' ? 'bg-purple-500/20 text-purple-400' : 'text-slate-400'}`}><Icon name="Layout" /></button>
                                <button onClick={() => setActiveView('quests')} className={`p-2 rounded-lg ${activeView === 'quests' ? 'bg-purple-500/20 text-purple-400' : 'text-slate-400'}`}><Icon name="Zap" /></button>
                            </div>
                        </div>
                    </nav>
                    <main className="max-w-4xl mx-auto p-6">
                        {activeView === 'dashboard' ? <Dashboard /> : <Quests />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProjectMargo />);
    </script>
</body>
</html>
