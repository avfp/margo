<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Margo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #020617; color: white; min-height: 100vh; }
        .achievement-pop { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const LucideIcon = lucide[name] || lucide.HelpCircle;
            return <LucideIcon size={size} className={className} />;
        };

        const ProjectMargo = () => {
            const [activeView, setActiveView] = useState('dashboard');
            const [showAch, setShowAch] = useState(null);
            const [gameData, setGameData] = useState(() => {
                const saved = localStorage.getItem('margo_v4');
                return saved ? JSON.parse(saved) : {
                    character: { name: 'Hero', title: 'Novice Adventurer', avatar: 'ðŸ§™â€â™€ï¸' },
                    paths: {
                        scholar: { name: 'The Scholar', level: 1, xp: 0, maxXp: 100, icon: 'Book' },
                        author: { name: 'The Author', level: 1, xp: 0, maxXp: 100, icon: 'Feather' },
                        leader: { name: 'The Leader', level: 1, xp: 0, maxXp: 100, icon: 'Crown' },
                        vessel: { name: 'The Vessel', level: 1, xp: 0, maxXp: 100, icon: 'Heart' }
                    },
                    dailyHabits: [],
                    completedToday: [],
                    streaks: {},
                    achievements: [],
                    totalXP: 0
                };
            });

            useEffect(() => {
                localStorage.setItem('margo_v4', JSON.stringify(gameData));
            }, [gameData]);

            const addXP = (pathKey, amount) => {
                setGameData(prev => {
                    const path = prev.paths[pathKey];
                    let nXp = path.xp + amount;
                    let nLvl = path.level;
                    let nMax = path.maxXp;
                    while (nXp >= nMax) { nXp -= nMax; nLvl++; nMax = Math.floor(nMax * 1.5); }
                    return {
                        ...prev,
                        paths: { ...prev.paths, [pathKey]: { ...path, xp: Math.max(0, nXp), level: nLvl, maxXp: nMax } },
                        totalXP: prev.totalXP + amount
                    };
                });
            };

            const toggleHabit = (id) => {
                const habit = gameData.dailyHabits.find(h => h.id === id);
                const isDone = gameData.completedToday.includes(id);
                setGameData(prev => ({
                    ...prev,
                    completedToday: isDone ? prev.completedToday.filter(i => i !== id) : [...prev.completedToday, id],
                    streaks: { ...prev.streaks, [id]: isDone ? Math.max(0, (prev.streaks[id] || 1) - 1) : (prev.streaks[id] || 0) + 1 }
                }));
                addXP(habit.pathKey, isDone ? -15 : 15);
            };

            const addHabit = (name, pathKey) => {
                const id = Date.now().toString();
                setGameData(prev => ({
                    ...prev,
                    dailyHabits: [...prev.dailyHabits, { id, name, pathKey }]
                }));
            };

            const deleteHabit = (id) => {
                setGameData(prev => ({
                    ...prev,
                    dailyHabits: prev.dailyHabits.filter(h => h.id !== id),
                    completedToday: prev.completedToday.filter(i => i !== id)
                }));
            };

            // Views
            const Dashboard = () => (
                <div className="space-y-6 animate-achievement-pop">
                    <div className="bg-slate-900 border-2 border-purple-500 p-6 rounded-2xl flex items-center gap-4">
                        <div className="text-5xl">{gameData.character.avatar}</div>
                        <div>
                            <h2 className="text-2xl font-bold">{gameData.character.name}</h2>
                            <p className="text-purple-400">{gameData.character.title}</p>
                            <p className="text-xs text-slate-500">Total XP: {gameData.totalXP}</p>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {Object.entries(gameData.paths).map(([key, path]) => (
                            <div key={key} className="bg-slate-800 p-4 rounded-xl border border-white/10">
                                <div className="flex justify-between items-center mb-2">
                                    <div className="flex items-center gap-2"><Icon name={path.icon} /><span className="font-bold">{path.name}</span></div>
                                    <span className="text-yellow-500 text-sm">Lv. {path.level}</span>
                                </div>
                                <div className="h-2 bg-black rounded-full overflow-hidden">
                                    <div className="h-full bg-blue-500" style={{width:`${(path.xp/path.maxXp)*100}%`}}></div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const Quests = () => {
                const [val, setVal] = useState('');
                const [pk, setPk] = useState('scholar');
                return (
                    <div className="space-y-4">
                        <div className="flex gap-2 bg-slate-800 p-2 rounded-lg">
                            <input className="bg-transparent flex-1 p-2 outline-none" placeholder="New Quest..." value={val} onChange={e=>setVal(e.target.value)} />
                            <select className="bg-slate-700 rounded px-2 text-sm" onChange={e=>setPk(e.target.value)}>
                                {Object.keys(gameData.paths).map(k=><option key={k} value={k}>{k}</option>)}
                            </select>
                            <button className="bg-purple-600 px-4 py-1 rounded font-bold" onClick={()=>{if(val){addHabit(val,pk);setVal('')}}}>Add</button>
                        </div>
                        {gameData.dailyHabits.map(h => (
                            <div key={h.id} className="bg-slate-900 p-4 rounded-lg flex items-center justify-between border border-white/5">
                                <div className="flex items-center gap-3">
                                    <button onClick={()=>toggleHabit(h.id)} className={`w-6 h-6 rounded border-2 flex items-center justify-center ${gameData.completedToday.includes(h.id) ? 'bg-green-500 border-green-400' : 'border-slate-600'}`}>
                                        {gameData.completedToday.includes(h.id) && <Icon name="Check" size={14} />}
                                    </button>
                                    <div>
                                        <p className={gameData.completedToday.includes(h.id) ? 'line-through text-slate-500' : ''}>{h.name}</p>
                                        <div className="flex items-center gap-1 text-[10px] text-orange-400 font-bold">
                                            <Icon name="Flame" size={10} /> {gameData.streaks[h.id] || 0} DAY STREAK
                                        </div>
                                    </div>
                                </div>
                                <button onClick={()=>deleteHabit(h.id)} className="text-slate-600 hover:text-red-500"><Icon name="Trash2" size={16} /></button>
                            </div>
                        ))}
                    </div>
                );
            };

            const Character = () => (
                <div className="bg-slate-900 p-6 rounded-2xl border border-purple-500/30">
                    <h2 className="text-2xl font-bold mb-4">Achievements</h2>
                    <div className="grid grid-cols-2 gap-3">
                        {gameData.achievements.length > 0 ? gameData.achievements.map(a => (
                            <div key={a} className="bg-slate-800 p-3 rounded-lg border border-yellow-500/50 text-sm flex items-center gap-2">
                                <Icon name="Trophy" className="text-yellow-500" /> {a.replace('_', ' ')}
                            </div>
                        )) : <p className="text-slate-500 italic">No achievements yet. Keep questing!</p>}
                    </div>
                </div>
            );

            return (
                <div className="max-w-2xl mx-auto px-4">
                    <nav className="py-6 flex justify-between items-center border-b border-white/10 mb-6">
                        <h1 className="text-xl font-black text-purple-400 uppercase tracking-widest">Margo</h1>
                        <div className="flex gap-4">
                            <button onClick={()=>setActiveView('dashboard')} className={activeView==='dashboard'?'text-white':'text-slate-500'}><Icon name="Layout" /></button>
                            <button onClick={()=>setActiveView('quests')} className={activeView==='quests'?'text-white':'text-slate-500'}><Icon name="Zap" /></button>
                            <button onClick={()=>setActiveView('character')} className={activeView==='character'?'text-white':'text-slate-500'}><Icon name="User" /></button>
                        </div>
                    </nav>
                    {activeView === 'dashboard' && <Dashboard />}
                    {activeView === 'quests' && <Quests />}
                    {activeView === 'character' && <Character />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProjectMargo />);
    </script>
</body>
</html>
